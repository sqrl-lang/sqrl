<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>SQRL | Where Clauses </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <!-- fonts -->
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet">

    <!-- stylesheets -->
    <link rel="stylesheet" href="/sqrl/style/doc.css">

    <!-- favicon -->
    <link rel="icon" href="/sqrl/images/favicon.ico">

    

  <meta name="generator" content="Hexo 6.3.0"></head>
  <body>

   <script>window.__INITIAL_STATE__ = {"page":{"title":"Where Clauses","path":"language/where.html"},"data":{"navigation":{"logo":{"text":"SQRL Documentation","type":"link","path":"index.html"},"main":[{"text":"Introduction","type":"link","path":"index.html"},{"text":"Motivation","type":"link","path":"motivation.html"},{"text":"Tutorial","type":"link","path":"tutorial.html"},{"text":"Why is it unique?","type":"link","path":"unique.html"},{"text":"FAQ","type":"link","path":"faq.html"},{"text":"Examples","type":"label","children":[{"text":"Redis Database","type":"link","path":"examples/redis.html"},{"text":"REPL","type":"link","path":"examples/repl.html"},{"text":"Wikipedia","type":"link","path":"examples/wikipedia.html"}]},{"text":"Concepts","type":"label","children":[{"text":"Entities","type":"link","path":"language/entities.html"},{"text":"Labels","type":"link","path":"language/labels.html"},{"text":"Simple Counters","type":"link","path":"counters/simple.html"},{"text":"Unique Counters","type":"link","path":"counters/unique.html"},{"text":"Rate limiters","type":"link","path":"counters/ratelimit.html"},{"text":"Sessionization","type":"link","path":"counters/session.html"},{"text":"Text Pattern Matching","type":"link","path":"language/textpattern.html"},{"text":"Include and Where Clauses","type":"link","path":"language/where.html"},{"text":"Cost Optimisation","type":"link","path":"language/cost.html"}]},{"text":"Standard Library","type":"label","children":[{"text":"Assert Functions","type":"link","path":"stdlib/assert.html"},{"text":"Bool Functions","type":"link","path":"stdlib/bool.html"},{"text":"Control Functions","type":"link","path":"stdlib/control.html"},{"text":"Data Functions","type":"link","path":"stdlib/data.html"},{"text":"Date-time Functions","type":"link","path":"stdlib/date-time.html"},{"text":"Entity Functions","type":"link","path":"stdlib/entity.html"},{"text":"List Functions","type":"link","path":"stdlib/list.html"},{"text":"Math Functions","type":"link","path":"stdlib/math.html"},{"text":"String Functions","type":"link","path":"stdlib/string.html"},{"text":"Type Functions","type":"link","path":"stdlib/type.html"}]},{"text":"Function Packages","type":"label","children":[{"text":"sqrl-cli-functions","type":"link","path":"packages/sqrl-cli-functions.html"},{"text":"sqrl-load-functions","type":"link","path":"packages/sqrl-load-functions.html"},{"text":"sqrl-redis-functions","type":"link","path":"packages/sqrl-redis-functions.html"},{"text":"sqrl-text-functions","type":"link","path":"packages/sqrl-text-functions.html"}]},{"text":"Defining Functions","type":"label","children":[{"text":"Simple Functions","type":"link","path":"functions/simple.html"},{"text":"Statements","type":"link","path":"functions/statement.html"},{"text":"When Clauses","type":"link","path":"functions/when.html"},{"text":"Custom Functions","type":"link","path":"functions/custom.html"}]},{"text":"Production Deployments","type":"label","children":[{"text":"Sync and Async","type":"link","path":"deployment/async.html"},{"text":"Http Server","type":"link","path":"deployment/server.html"},{"text":"Queues","type":"link","path":"deployment/queue.html"}]},{"text":"External Resources","type":"label"},{"text":"API Reference","type":"link","path":"reference/index.html"},{"text":"Discord Chat","type":"link","path":"https://discord.gg/mMJwWT6"},{"text":"View on GitHub","type":"link","path":"https://github.com/sqrl-lang/sqrl"}]}},"config":{"timezone":"UTC","root":"/sqrl/","time_format":"HH:mm:ss","theme":"sqrl-hexo-theme-doc","theme_config":{"swagger_ui":{"version":2,"permalinks":true,"api_explorer":true,"download":"Download specification","show_extensions":false,"deep_linking":true,"display_operation_id":false,"doc_expansion":"none"},"search":{"skip":false,"background":false,"route":"/lunr.json"},"favicon":"images/favicon.ico"}}}</script>

    <div id="react-navigation-root"><div class="doc-navigation" data-reactroot=""><nav class="doc-navbar"><a href="/sqrl/index.html" class="doc-navbar__logo"><img src="/sqrl/images/logo.png" class="doc-navbar__logo__img"/><span class="doc-navbar__logo__text">SQRL Documentation</span></a><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"></i><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"></div><ul class="doc-sidebar-list"></ul></div></nav></div></div>
    <div class="doc-content">
  <div class="dc-page">
    <div class="dc-card">
      <div id="react-search-results-root"></div>
      <div id="page-content" class="doc-formatting">
        <html><head></head><body><h1 id="Where-Clauses"><a href="#Where-Clauses" class="headerlink" title="Where Clauses"></a>Where Clauses</h1><p>In order to get an in-depth understanding of SQRL it is vital that you understand how WHERE statements affect underlying counters and rules.</p>
<p>Limitations on expressions in WHERE statements<br>In order to provide automatic counters and other similar features, we impose some limitations on the syntax you are allowed to use inside a where statement.</p>
<p>This is restricted to the following operations:</p>
<ul>
<li>Features, and unary <strong>NOT</strong> (i.e. WHERE <em>IsLogin</em>, WHERE <em>NOT IsSignup</em>)</li>
<li>Boolean <strong>AND</strong>/<strong>OR</strong> (i.e. WHERE <em>IsSignup AND TrustedIp</em>, WHERE <em>(X AND Y) OR Z</em>)</li>
<li>Equality (<strong>=</strong>) / inequality (<strong>!=</strong>) to constants (i.e. WHERE <em>Username=”josh”</em>, WHERE <em>Ip!=”127.0.0.1”</em>“)</li>
</ul>
<h2 id="Counter-values"><a href="#Counter-values" class="headerlink" title="Counter values"></a>Counter values</h2><p>For most counters SQRL will only track the counts that exist in the source code. It is important to identify how counters are uniquely identified in SQRL to avoid unintentionally changing the identification of a counter (and losing all previous values).</p>
<p>For example the following two counters are maintained separately:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LET LoginCount := count(BY SessionActor WHERE Event="login");</span><br><span class="line">LET PurchaseCount := count(BY SessionActor WHERE Event="purchase");</span><br></pre></td></tr></tbody></table></figure>
<p>This is to be expected. LoginCount is a count of logins, while PurchaseCount is a count of purchases. Internally we track the features used in the WHERE statement and use them to identify the counter.</p>
<p>Using <code>Event</code> directly in count() is not recommended though, because in future you may wish to add a new action <code>"mobile_login"</code>, or perhaps change <code>"login"</code> to <code>"logged_in"</code>. Changing the constant in the <code>Event="X"</code> where clause would use a new set of counters.</p>
<p>Instead we recommend you use additional feature:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LET IsLogin := Event = "login";</span><br><span class="line">LET LoginCount := count(BY SessionActor WHERE IsLogin);</span><br></pre></td></tr></tbody></table></figure>

<p>With this change later we can safely update IsLogin.</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LET IsLogin := Event IN ["login", "mobile_login"];</span><br><span class="line">LET LoginCount := count(BY SessionActor WHERE IsLogin);</span><br></pre></td></tr></tbody></table></figure>

<p>In the above case since the body of the WHERE clause did not change any previous tracked counts under the <code>"login"</code> event will still exist.</p>
<h2 id="INCLUDE-statements"><a href="#INCLUDE-statements" class="headerlink" title="INCLUDE statements"></a>INCLUDE statements</h2><p>When you include a file with a WHERE clause every statement in that file is included with that additional expression.</p>
<p>This is most clearly demonstrated by taking the following combination of files:</p>
<p><strong>rules/purchase.sqrl</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">LET NumPurchaseByActor := count(BY SessionActor);</span><br><span class="line">LET ManyPurchaseByActor := NumPurchaseByActor &gt; 5;</span><br><span class="line">CREATE RULE ManyPurchase WHERE ManyPurchaseByActor;</span><br></pre></td></tr></tbody></table></figure>

<p><strong>main.sqrl</strong></p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">LET IsPurchase := Event = "purchase";</span><br><span class="line">INCLUDE "purchase.sqrl" WHERE IsPurchase;</span><br></pre></td></tr></tbody></table></figure>

<p>To achieve the same thing in a single file, the equivalent SQRL code would be:</p>
<figure class="highlight plaintext"><table><tbody><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">LET IsPurchase := Event = "purchase";</span><br><span class="line">LET NumPurchaseByActor := if(IsPurchase, count(BY SessionActor WHERE IsPurchase));</span><br><span class="line">LET ManyPurchaseByActor := if(IsPurchase, NumPurchaseByActor &gt; 5);</span><br><span class="line">CREATE RULE ManyPurchases WHERE ManyPurchaseByActor AND IsPurchase;</span><br></pre></td></tr></tbody></table></figure></body></html>
        <div id="react-support-footer-root"></div>
      </div>
    </div>
  </div>
</div>

    


    

    <!-- js vendors -->
    <script src="//code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.0/lunr.min.js"></script>

    <!-- js source  -->
    <script src="/sqrl/script/doc.js"></script>

    

  </body>
</html>
