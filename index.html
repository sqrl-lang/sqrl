<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />

    <title>SQRL | Home</title>
    <meta name="description" content="" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <!-- fonts -->
    <link
      href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700"
      rel="stylesheet"
    />
    <link
      href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700"
      rel="stylesheet"
    />

    <!-- stylesheets -->
    <link rel="stylesheet" href="/sqrl/style/doc.css" />

    <!-- favicon -->
    <link rel="icon" href="/sqrl/images/favicon.ico" />

    <meta name="generator" content="Hexo 6.3.0" />
  </head>
  <body>
    <script>
      window.__INITIAL_STATE__ = {
        page: { title: "Home", path: "index.html" },
        data: {
          navigation: {
            logo: {
              text: "SQRL Documentation",
              type: "link",
              path: "index.html",
            },
            main: [
              { text: "Introduction", type: "link", path: "index.html" },
              { text: "Motivation", type: "link", path: "motivation.html" },
              { text: "Tutorial", type: "link", path: "tutorial.html" },
              { text: "Why is it unique?", type: "link", path: "unique.html" },
              { text: "FAQ", type: "link", path: "faq.html" },
              {
                text: "Examples",
                type: "label",
                children: [
                  {
                    text: "Redis Database",
                    type: "link",
                    path: "examples/redis.html",
                  },
                  { text: "REPL", type: "link", path: "examples/repl.html" },
                  {
                    text: "Wikipedia",
                    type: "link",
                    path: "examples/wikipedia.html",
                  },
                ],
              },
              {
                text: "Concepts",
                type: "label",
                children: [
                  {
                    text: "Entities",
                    type: "link",
                    path: "language/entities.html",
                  },
                  {
                    text: "Labels",
                    type: "link",
                    path: "language/labels.html",
                  },
                  {
                    text: "Simple Counters",
                    type: "link",
                    path: "counters/simple.html",
                  },
                  {
                    text: "Unique Counters",
                    type: "link",
                    path: "counters/unique.html",
                  },
                  {
                    text: "Rate limiters",
                    type: "link",
                    path: "counters/ratelimit.html",
                  },
                  {
                    text: "Sessionization",
                    type: "link",
                    path: "counters/session.html",
                  },
                  {
                    text: "Text Pattern Matching",
                    type: "link",
                    path: "language/textpattern.html",
                  },
                  {
                    text: "Include and Where Clauses",
                    type: "link",
                    path: "language/where.html",
                  },
                  {
                    text: "Cost Optimisation",
                    type: "link",
                    path: "language/cost.html",
                  },
                ],
              },
              {
                text: "Standard Library",
                type: "label",
                children: [
                  {
                    text: "Assert Functions",
                    type: "link",
                    path: "stdlib/assert.html",
                  },
                  {
                    text: "Bool Functions",
                    type: "link",
                    path: "stdlib/bool.html",
                  },
                  {
                    text: "Control Functions",
                    type: "link",
                    path: "stdlib/control.html",
                  },
                  {
                    text: "Data Functions",
                    type: "link",
                    path: "stdlib/data.html",
                  },
                  {
                    text: "Date-time Functions",
                    type: "link",
                    path: "stdlib/date-time.html",
                  },
                  {
                    text: "Entity Functions",
                    type: "link",
                    path: "stdlib/entity.html",
                  },
                  {
                    text: "List Functions",
                    type: "link",
                    path: "stdlib/list.html",
                  },
                  {
                    text: "Math Functions",
                    type: "link",
                    path: "stdlib/math.html",
                  },
                  {
                    text: "String Functions",
                    type: "link",
                    path: "stdlib/string.html",
                  },
                  {
                    text: "Type Functions",
                    type: "link",
                    path: "stdlib/type.html",
                  },
                ],
              },
              {
                text: "Function Packages",
                type: "label",
                children: [
                  {
                    text: "sqrl-cli-functions",
                    type: "link",
                    path: "packages/sqrl-cli-functions.html",
                  },
                  {
                    text: "sqrl-load-functions",
                    type: "link",
                    path: "packages/sqrl-load-functions.html",
                  },
                  {
                    text: "sqrl-redis-functions",
                    type: "link",
                    path: "packages/sqrl-redis-functions.html",
                  },
                  {
                    text: "sqrl-text-functions",
                    type: "link",
                    path: "packages/sqrl-text-functions.html",
                  },
                ],
              },
              {
                text: "Defining Functions",
                type: "label",
                children: [
                  {
                    text: "Simple Functions",
                    type: "link",
                    path: "functions/simple.html",
                  },
                  {
                    text: "Statements",
                    type: "link",
                    path: "functions/statement.html",
                  },
                  {
                    text: "When Clauses",
                    type: "link",
                    path: "functions/when.html",
                  },
                  {
                    text: "Custom Functions",
                    type: "link",
                    path: "functions/custom.html",
                  },
                ],
              },
              {
                text: "Production Deployments",
                type: "label",
                children: [
                  {
                    text: "Sync and Async",
                    type: "link",
                    path: "deployment/async.html",
                  },
                  {
                    text: "Http Server",
                    type: "link",
                    path: "deployment/server.html",
                  },
                  {
                    text: "Queues",
                    type: "link",
                    path: "deployment/queue.html",
                  },
                ],
              },
              { text: "External Resources", type: "label" },
              {
                text: "API Reference",
                type: "link",
                path: "reference/globals.html",
              },
              {
                text: "Discord Chat",
                type: "link",
                path: "https://discord.gg/mMJwWT6",
              },
              {
                text: "View on GitHub",
                type: "link",
                path: "https://github.com/sqrl-lang/sqrl",
              },
            ],
          },
        },
        config: {
          timezone: "UTC",
          root: "/sqrl/",
          time_format: "HH:mm:ss",
          theme: "sqrl-hexo-theme-doc",
          theme_config: {
            swagger_ui: {
              version: 2,
              permalinks: true,
              api_explorer: true,
              download: "Download specification",
              show_extensions: false,
              deep_linking: true,
              display_operation_id: false,
              doc_expansion: "none",
            },
            search: { skip: false, background: false, route: "/lunr.json" },
            favicon: "images/favicon.ico",
          },
        },
      };
    </script>

    <div id="react-navigation-root">
      <div class="doc-navigation" data-reactroot="">
        <nav class="doc-navbar">
          <a href="/sqrl/index.html" class="doc-navbar__logo"
            ><img
              src="/sqrl/images/logo.png"
              class="doc-navbar__logo__img"
            /><span class="doc-navbar__logo__text">SQRL Documentation</span></a
          ><i
            class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"
          ></i
          ><i
            class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"
          ></i>
        </nav>
        <nav class="doc-sidebar">
          <div class="doc-sidebar__vertical-menu">
            <i
              class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"
            ></i
            ><i
              class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"
            ></i>
          </div>
          <div class="doc-sidebar-content">
            <div class="doc-sidebar__search-form"></div>
            <ul class="doc-sidebar-list"></ul>
          </div>
        </nav>
      </div>
    </div>
    <div class="doc-content">
      <div class="dc-page">
        <div class="dc-card">
          <div id="react-search-results-root"></div>
          <div id="page-content" class="doc-formatting">
            <html>
              <head></head>
              <body>
                <h1 id="SQRL-A-Safe-Stateful-Language-for-Event-Streams">
                  <a
                    href="#SQRL-A-Safe-Stateful-Language-for-Event-Streams"
                    class="headerlink"
                    title="SQRL: A Safe, Stateful Language for Event Streams"
                  ></a
                  >SQRL: A Safe, Stateful Language for Event Streams
                </h1>
                <p>
                  <strong>Instant</strong> – New features and rules can be
                  deployed to production in seconds.<br /><strong
                    >Inclusive</strong
                  >
                  – Non-technical users can review and safely deploy changes to
                  production without talking to an engineer.<br /><strong
                    >Powerful</strong
                  >
                  – Rules can declaratively aggregate state, trigger side
                  effects, and call functions in other languages.<br /><strong
                    >Auditable</strong
                  >
                  – It’s easy to understand why a rule fired or a side effect
                  occured, and rules can be safely replayed.
                </p>
                <p>
                  You can see a demonstration running on
                  <a
                    target="_blank"
                    rel="noopener"
                    href="https://websqrl.vercel.app/wikipedia"
                    >Wikipedia Recent Changes</a
                  >
                  or the
                  <a
                    target="_blank"
                    rel="noopener"
                    href="https://websqrl.vercel.app/twitter"
                    >Twitter sampled stream</a
                  >.
                </p>
                <h2 id="Community">
                  <a href="#Community" class="headerlink" title="Community"></a
                  >Community
                </h2>
                <p>
                  Come talk to us on the
                  <a
                    target="_blank"
                    rel="noopener"
                    href="https://discord.gg/mMJwWT6"
                    >SQRL discord server</a
                  >
                </p>
                <h2 id="Getting-started">
                  <a
                    href="#Getting-started"
                    class="headerlink"
                    title="Getting started"
                  ></a
                  >Getting started
                </h2>
                <p>
                  <strong>SQRL</strong> (Smyte Query and Rules Language) is
                  designed to be used as a library, but the easiest way to start
                  is with the command line interface.
                </p>
                <figure class="highlight plaintext">
                  <table>
                    <tbody>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">$ npm install --global sqrl-cli</span><br><span class="line">$ cat &lt;&lt;EOF &gt; simple.sqrl</span><br><span class="line">LET Username := input();</span><br><span class="line">LET Message := concat("Hello, ", Username, "!");</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">$ sqrl run simple.sqrl -s 'Username="josh"' Message</span><br><span class="line">✓ 2019-01-14 15:09 action was allowed.</span><br><span class="line">Message="Hello, josh!"</span><br></pre>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </figure>

                <p>Once you have the command line running, you could:</p>
                <ul>
                  <li>
                    Read about our <a href="motivation.html">motivations</a> for
                    writing SQRL
                  </li>
                  <li>
                    Learn about the
                    <a href="unique.html">features that make SQRL unique</a>
                  </li>
                  <li>
                    Try write some basic SQRL in the
                    <a href="tutorial.html">Tutorial</a>
                  </li>
                  <li>
                    Set up external state storage in
                    <a href="examples/redis.html">Redis</a>
                  </li>
                  <li>
                    See a real-life use case on
                    <a href="examples/wikipedia.html">Wikipedia</a>
                  </li>
                </ul>
                <h2 id="SQRL-snippets">
                  <a
                    href="#SQRL-snippets"
                    class="headerlink"
                    title="SQRL snippets"
                  ></a
                  >SQRL snippets
                </h2>
                <h3 id="Stopping-account-compromise">
                  <a
                    href="#Stopping-account-compromise"
                    class="headerlink"
                    title="Stopping account compromise"
                  ></a
                  >Stopping account compromise
                </h3>
                <figure class="highlight plaintext">
                  <table>
                    <tbody>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-- Check for lots of failed login attempts from a single IP address</span><br><span class="line">LET NumLoginAttemptsForIpLastDay := count(BY Ip LAST DAY);</span><br><span class="line">LET NumFailedLoginsForIpLastDay := count(BY Ip WHERE IsFailedLogin LAST DAY);</span><br><span class="line">CREATE RULE IsCredentialStuffingLoginAttempt WHERE</span><br><span class="line">  NumLoginAttemptsForIpLastDay &gt; 20 AND</span><br><span class="line">  NumLoginAttemptsForIpLastDay / NumFailedLoginsForIpLastDay &gt; 0.9</span><br><span class="line">  WITH REASON "IP ${Ip} had ${NumLoginAttemptsForIpLastDay} login attempts in "</span><br><span class="line">              "the last day and more than 90% of those failed."</span><br></pre>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </figure>

                <h3 id="Mitigating-abuse-and-bullying">
                  <a
                    href="#Mitigating-abuse-and-bullying"
                    class="headerlink"
                    title="Mitigating abuse and bullying"
                  ></a
                  >Mitigating abuse and bullying
                </h3>
                <figure class="highlight plaintext">
                  <table>
                    <tbody>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-- If users swear too much we give them a warning</span><br><span class="line">LET UsedBadWord := patternMatches("BadWords.txt", UserGeneratedText);</span><br><span class="line">LET NumStrikes := count(BY User WHERE UsedBadWord LAST WEEK);</span><br><span class="line">CREATE RULE IsToxicComment</span><br><span class="line">  WHERE NumStrikes &gt; 3</span><br><span class="line">  WITH REASON "User sent ${NumStrikes} messages with bad words in the last week."</span><br></pre>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </figure>

                <h3 id="Preventing-credit-card-fraud">
                  <a
                    href="#Preventing-credit-card-fraud"
                    class="headerlink"
                    title="Preventing credit card fraud"
                  ></a
                  >Preventing credit card fraud
                </h3>
                <figure class="highlight plaintext">
                  <table>
                    <tbody>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-- If a single user is using lots of credit cards it's an indicator of fraud</span><br><span class="line">LET NumCards := countUnique(CreditCard BY Actor LAST 5 DAYS);</span><br><span class="line">CREATE RULE SuspiciousNumCreditCards</span><br><span class="line">  WHERE NumCards &gt; 4</span><br><span class="line">  WITH REASON "User ${Actor} used ${NumCards} in the last 5 days";</span><br><span class="line"></span><br><span class="line">-- If a credit card was used in multiple risky countries then it's suspicious</span><br><span class="line">LET NumRiskyCountries := countUnique(</span><br><span class="line">  Country BY CreditCard WHERE RiskyCountry LAST 5 DAYS);</span><br><span class="line">CREATE RULE MultiRiskyCountryCreditCard WHERE NumRiskyCountries &gt; 1</span><br><span class="line">  WITH REASON "Credit card was used in ${NumRiskyCountries} risky "</span><br><span class="line">              "countries in last 5 days.";</span><br></pre>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </figure>

                <h3 id="Identifying-duplicate-accounts">
                  <a
                    href="#Identifying-duplicate-accounts"
                    class="headerlink"
                    title="Identifying duplicate accounts"
                  ></a
                  >Identifying duplicate accounts
                </h3>
                <figure class="highlight plaintext">
                  <table>
                    <tbody>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-- If a user has signed up with the same normalized email address (i.e.</span><br><span class="line">-- lowercased, removing + suffixes, etc), cookie, or phone number, or if a</span><br><span class="line">-- subnet is creating lots of accounts, flag it.</span><br><span class="line">LET NormalizedActorEmail := normalizeEmail(ActorEmail);</span><br><span class="line">LET NumSignupsByNormalizedActorEmail := count(BY NormalizedActorEmail TOTAL);</span><br><span class="line">LET NumSignupsByBrowserCookie := count(BY BrowserCookie TOTAL);</span><br><span class="line">LET NumSignupsByActorPhone := count(BY ActorPhone TOTAL);</span><br><span class="line">CREATE RULE IsDuplicateSignup</span><br><span class="line">  WHERE NumSignupsByNormalizedActorEmail &gt; 1 OR NumSignupsByBrowserCookie &gt; 1 OR</span><br><span class="line">        NumSignupsByActorPhone &gt; 1 OR rateLimited(BY IpNetwork MAX 100 EVERY DAY)</span><br><span class="line">  WITH REASON "Signup was a duplicate."</span><br></pre>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </figure>

                <h3 id="Stopping-spam">
                  <a
                    href="#Stopping-spam"
                    class="headerlink"
                    title="Stopping spam"
                  ></a
                  >Stopping spam
                </h3>
                <figure class="highlight plaintext">
                  <table>
                    <tbody>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-- Limit quickly accelerating, similar looking messages.</span><br><span class="line">-- It's a good idea to do this with URLs too.</span><br><span class="line">LET Simhash := simhash(UserGeneratedText);</span><br><span class="line">LET NumSimhashWeek := count(BY Simhash LAST WEEK);</span><br><span class="line">LET NumSimhashDay := count(BY Simhash LAST DAY);</span><br><span class="line"></span><br><span class="line">CREATE RULE IsSpammyMessage</span><br><span class="line">  WHERE NumSimhashDay &gt; 50 AND NumSimhashDay / NumSimhashWeek &gt; 0.9</span><br><span class="line">  WITH REASON "A simhash was used ${NumSimhashDay} times in the last day, "</span><br><span class="line">              "but only ${NumSimhashWeek} times in the last week.";</span><br></pre>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </figure>

                <h3 id="Interfacing-with-ML-models">
                  <a
                    href="#Interfacing-with-ML-models"
                    class="headerlink"
                    title="Interfacing with ML models"
                  ></a
                  >Interfacing with ML models
                </h3>
                <figure class="highlight plaintext">
                  <table>
                    <tbody>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-- When someone reports an NSFW image, automatically take it down if our NSFW</span><br><span class="line">-- model agrees and the reporter does not have a history of false positives.</span><br><span class="line">LET NsfwScore := mlScores("nsfw", ReportedImageUrl);</span><br><span class="line">LET IsLikelyNsfwImage := NsfwScore &gt; 0.92;</span><br><span class="line">LET NumReporterReports := count(BY Actor LAST MONTH);</span><br><span class="line">LET NumReporterFalsePositives :=</span><br><span class="line">  count(BY Actor WHERE NOT IsLikelyNsfwImage LAST MONTH);</span><br><span class="line">LET IsReporterTrustworthy :=</span><br><span class="line">  NumReporterReports &lt; 3 OR NumReporterFalsePositives / NumReporterReports &lt; 0.3;</span><br><span class="line">CREATE RULE AutomaticTakeDown</span><br><span class="line">  WHERE IsLikelyNsfwImage AND IsReporterTrustworthy</span><br><span class="line">  WITH REASON "Trustworthy reporter reported image with NSFW score ${NsfwScore}.";</span><br></pre>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </figure>

                <h3 id="Coupon-codes-for-high-value-users">
                  <a
                    href="#Coupon-codes-for-high-value-users"
                    class="headerlink"
                    title="Coupon codes for high-value users"
                  ></a
                  >Coupon codes for high-value users
                </h3>
                <figure class="highlight plaintext">
                  <table>
                    <tbody>
                      <tr>
                        <td class="gutter">
                          <pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre>
                        </td>
                        <td class="code">
                          <pre><span class="line">-- Give users spending $200 every month for at least 3 months a discount.</span><br><span class="line">LET PurchaseSession := sessionize(</span><br><span class="line">  BY User EVERY 1 MONTH WHERE PurchaseAmountUsd &gt;= 200);</span><br><span class="line">LET PurchaseSessionAgeInMonths := dateDiff(</span><br><span class="line">  "MONTH",</span><br><span class="line">  PurchaseSession,</span><br><span class="line">  Timestamp</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line">CREATE RULE GiveLoyaltyDiscount</span><br><span class="line">  WHERE PurchaseSessionAgeInMonths &gt;= 3</span><br><span class="line">  WITH REASON "User ${Actor} has made purchases for $200 or more for "</span><br><span class="line">              "than ${PurchaseSessionAgeInMonths} consecutive months."</span><br></pre>
                        </td>
                      </tr>
                    </tbody>
                  </table>
                </figure>

                <h2 id="Next-steps">
                  <a
                    href="#Next-steps"
                    class="headerlink"
                    title="Next steps"
                  ></a
                  >Next steps
                </h2>
                <ul>
                  <li>
                    Try out SQRL in the <a href="tutorial.html">Tutorial</a>
                  </li>
                  <li>
                    Set up external state storage in
                    <a href="examples/redis.html">Redis</a>
                  </li>
                  <li>
                    See a real-life use case on
                    <a href="examples/wikipedia.html">Wikipedia</a>
                  </li>
                </ul>
              </body>
            </html>
            <div id="react-support-footer-root"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- js vendors -->
    <script
      src="//code.jquery.com/jquery-3.2.1.min.js"
      crossorigin="anonymous"
    ></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.0/lunr.min.js"></script>

    <!-- js source  -->
    <script src="/sqrl/script/doc.js"></script>
  </body>
</html>
